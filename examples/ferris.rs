use macroquad::{prelude::*, texture::draw_texture, window::{clear_background, next_frame, screen_width, screen_height}};

struct Position{
   x: f32,
   y: f32,
   forward: bool,
   speed: f32,
}
#[macroquad::main("ferris in svg")]
async fn main() {
    let svg_data = "<svg
    width=\"320\"
    height=\"169\"
    viewBox=\"0 0 84.666665 44.714583\"
    version=\"1.1\"
    id=\"svg12924\"
    xmlns=\"http://www.w3.org/2000/svg\"
    xmlns:svg=\"http://www.w3.org/2000/svg\"><g
    id=\"g41029\"
    transform=\"translate(-12.103918,-13.202105)\">
   <path
      style=\"opacity:1;fill:#a52b00;fill-opacity:1;stroke:#000000;stroke-width:0.0718745px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"
      d=\"m 34.96799,53.282115 c -0.03139,-1.644888 -2.125503,-4.817409 -4.07171,-7.880393 16.894602,7.079916 42.432806,5.254569 50.690472,-1.678014 -1.542834,3.748472 -3.586629,8.375254 -3.649258,9.528558 4.523712,-6.212095 5.498084,-8.343481 8.246909,-12.514972 l -59.673796,0.525057 c 0.514727,3.028069 4.771312,7.645048 8.457383,12.019764 z\"
      id=\"path13145\" />
   <path
      style=\"opacity:1;fill:#f74c00;fill-opacity:1;stroke:#000000;stroke-width:0.0718745px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"
      d=\"m 19.293178,31.777801 -0.949755,-8.939702 c 1.327324,0.823066 9.47536,2.911371 4.379323,13.124487 l 3.472941,2.723866 0.975964,-0.682567 C 25.356524,35.82923 22.707325,33.45978 29.085542,33.198674 l 0.329419,-0.711465 c -1.809262,-3.020712 -2.796679,-5.568733 2.835134,-4.309647 l 0.467828,-0.64165 c -0.173007,-1.137558 -3.41883,-6.560896 3.477415,-3.667649 l 0.652206,-0.587713 c -0.968822,-4.32737 -0.0466,-5.932629 4.153888,-2.839349 l 0.674675,-0.395717 c 0.60426,-2.124053 -0.486442,-6.885402 4.596034,-2.041512 l 0.79126,-0.222617 c 1.159541,-1.464408 0.52808,-7.153357 4.918237,-0.997513 l 0.738494,-0.132829 c 3.085641,-6.6792997 3.871142,-1.427455 5.019243,0.06793 l 0.784501,0.07918 c 1.953142,-2.857683 3.815626,-4.866909 4.836609,0.999391 l 0.847831,0.249198 c 3.389978,-3.686848 4.65037,-2.417866 4.577428,1.953957 l 0.736612,0.394568 c 3.152923,-2.193222 5.272227,-2.537736 4.150655,2.914304 l 0.599449,0.516402 c 3.011308,-1.143626 5.886997,-2.113377 3.503428,3.65971 l 0.501847,0.667563 c 3.6797,-0.734638 5.880942,-0.284903 2.799232,4.396894 l 0.346476,0.629239 c 2.29446,0.567 6.569208,-0.127245 1.968939,4.83101 l 0.143696,0.480098 2.964546,-2.599793 0.568411,-1.45041 c -7.115403,-9.012909 3.248294,-12.497868 4.377989,-13.216444 -0.229136,2.439598 -0.944303,1.725875 -0.545322,8.24059 3.479541,-2.166941 3.991907,-4.444771 4.55562,-6.929503 4.433695,8.587399 -5.195105,13.075588 -5.847516,13.597662 l -3.425403,4.604735 3.004297,2.021202 c 0.386797,0.359241 0.734881,0.741194 0.211595,1.634326 -2.672694,4.609541 -5.955391,8.87066 -8.953742,13.294192 0.05999,-1.366996 0.599202,-2.888326 0.952803,-4.349879 l 3.474011,-8.960962 -3.963976,-1.065202 -1.911387,0.214075 c -20.417277,9.335305 -35.289851,4.908062 -50.257427,-0.35855 l -2.03008,1.467931 c 0.620521,2.93298 5.771649,9.145205 6.767729,12.610346 -4.973291,-3.893661 -7.933711,-7.764382 -11.680993,-11.644069 -0.759354,-0.867879 -0.372633,-1.52675 0.127367,-2.1728 l 2.486895,-2.323896 C 18.757301,37.816475 19.967557,37.498297 19.047482,36.2586 9.90676,31.871344 11.466664,28.055127 15.191833,24.35446 Z\"
      id=\"path13030\" />
   <path
      id=\"ellipse37144\"
      d=\"m 54.32385,39.128598 c 0.01573,3.059277 -1.578293,4.437261 -3.525217,4.437261 -1.946923,0 -3.88552,-1.344487 -3.88552,-3.795119 0,-2.450633 1.618058,-4.775221 3.564982,-4.775221 1.946924,0 3.832414,1.538072 3.845755,4.133079 z\"
      style=\"fill:#000000;stroke-width:0.271652\" />
   <path
      id=\"path27447-9\"
      style=\"fill:#ffffff;stroke-width:0.0860325\"
      d=\"m 50.728947,37.53566 c 0.0094,1.609911 -1.038113,1.974989 -1.702859,1.974989 -0.664746,0 -1.498041,-0.8241 -1.400076,-2.351194 0.04609,-0.718419 0.824055,-1.819079 1.488799,-1.819079 0.664745,0 1.6059,0.784107 1.614136,2.195284 z\" />
   <path
      id=\"ellipse37144-7\"
      d=\"m 66.515576,39.600957 c -0.08492,2.453314 -2.533511,3.641544 -3.926374,3.786038 -1.251829,0.129866 -3.43451,-1.527879 -3.43451,-3.978511 0,-2.450633 1.730413,-4.627907 3.664464,-4.404403 2.062403,0.23834 3.786193,2.003387 3.69642,4.596876 z\"
      style=\"opacity:1;fill:#000000;fill-opacity:1;stroke-width:0.271652\" />
   <path
      id=\"path27447-9-2\"
      style=\"opacity:1;fill:#ffffff;stroke-width:0.0860325\"
      d=\"m 63.355223,37.348981 c 0.0094,1.60991 -0.883133,2.096132 -1.547879,2.096132 -0.664746,0 -1.615759,-0.735701 -1.517796,-2.262796 0.04609,-0.718419 0.949758,-1.867099 1.614502,-1.867099 0.664746,0 1.442936,0.622585 1.451173,2.033763 z\" />
   <path
      style=\"fill:#000000;stroke:none;stroke-width:0.0718745px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"
      d=\"m 59.874768,44.889364 c -0.180529,2.490275 -4.437976,3.807787 -5.776051,0.395645 z\"
      id=\"path27676\" />
 </g></svg>";
    let texture = quad_svg::svg_to_texture(&svg_data);
    let mut positions: Vec<Position> = vec![];
    for _i in 0..50{
      positions.push(Position { 
         x: rand::gen_range(0.0, screen_width()-texture.width()),
         y: rand::gen_range(0.0, screen_height()-texture.height()),
         forward: rand::gen_range(0,2) == 1,
         speed: rand::gen_range(0.5, 5.0),
      })
    }
    loop {
        clear_background(LIGHTGRAY);
        for i in 0..positions.len() {
            draw_texture(
               texture,
               positions[i].x,
               positions[i].y,
               GRAY,
            );
            if positions[i].forward {
               positions[i].x += positions[i].speed
            }
            else {
               positions[i].x -= positions[i].speed
            }
            if positions[i].x + texture.width() > screen_width() {
               positions[i].x = screen_width() - texture.width();
               positions[i].forward = false;
            }
            if positions[i].x < 0.0 {
               positions[i].x = 0.0;
               positions[i].forward = true;
            }
        }
        next_frame().await
}

}